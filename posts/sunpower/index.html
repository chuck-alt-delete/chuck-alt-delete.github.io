<!DOCTYPE html>
<html lang="en" dir="auto">

<head><link rel="stylesheet" href="/css/admonition.css">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Sunpower | Chuck Alt Delete</title>
<meta name="keywords" content="">
<meta name="description" content="Sunpower Stats I have a MySunPower system, and I love looking at my data. However, the app is not as flexible a I want it to be. It only lets you see a graph of energy usage/production between two points in time. But I want to answer questions like “how has my usage/production been trending in the month of February over the last several years” or “what is the distribution of usage/production for the hour of 4-5pm” or &ldquo;how does the last 4 months of usage compare to the same period the previous year&rdquo;.">
<meta name="author" content="">
<link rel="canonical" href="https://chuck-alt-delete.github.io/posts/sunpower/">
<meta name="google-site-verification" content="G-S20RBCMJWE">
<link crossorigin="anonymous" href="/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css" integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z&#43;V9&#43;cO1A=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://chuck-alt-delete.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://chuck-alt-delete.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://chuck-alt-delete.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://chuck-alt-delete.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://chuck-alt-delete.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://chuck-alt-delete.github.io/posts/sunpower/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-S20RBCMJWE"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-S20RBCMJWE', { 'anonymize_ip': false });
}
</script>
<meta property="og:title" content="Sunpower" />
<meta property="og:description" content="Sunpower Stats I have a MySunPower system, and I love looking at my data. However, the app is not as flexible a I want it to be. It only lets you see a graph of energy usage/production between two points in time. But I want to answer questions like “how has my usage/production been trending in the month of February over the last several years” or “what is the distribution of usage/production for the hour of 4-5pm” or &ldquo;how does the last 4 months of usage compare to the same period the previous year&rdquo;." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://chuck-alt-delete.github.io/posts/sunpower/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-04-15T15:00:04-07:00" />
<meta property="article:modified_time" content="2024-04-15T15:00:04-07:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Sunpower"/>
<meta name="twitter:description" content="Sunpower Stats I have a MySunPower system, and I love looking at my data. However, the app is not as flexible a I want it to be. It only lets you see a graph of energy usage/production between two points in time. But I want to answer questions like “how has my usage/production been trending in the month of February over the last several years” or “what is the distribution of usage/production for the hour of 4-5pm” or &ldquo;how does the last 4 months of usage compare to the same period the previous year&rdquo;."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://chuck-alt-delete.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Sunpower",
      "item": "https://chuck-alt-delete.github.io/posts/sunpower/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Sunpower",
  "name": "Sunpower",
  "description": "Sunpower Stats I have a MySunPower system, and I love looking at my data. However, the app is not as flexible a I want it to be. It only lets you see a graph of energy usage/production between two points in time. But I want to answer questions like “how has my usage/production been trending in the month of February over the last several years” or “what is the distribution of usage/production for the hour of 4-5pm” or \u0026ldquo;how does the last 4 months of usage compare to the same period the previous year\u0026rdquo;.",
  "keywords": [
    
  ],
  "articleBody": "Sunpower Stats I have a MySunPower system, and I love looking at my data. However, the app is not as flexible a I want it to be. It only lets you see a graph of energy usage/production between two points in time. But I want to answer questions like “how has my usage/production been trending in the month of February over the last several years” or “what is the distribution of usage/production for the hour of 4-5pm” or “how does the last 4 months of usage compare to the same period the previous year”.\nWell, here’s the result!\nGo to the GitHub repo to see:\nPython functions for interacting with the MySunPower GraphQL API to download data locally documentation to interact with data locally via duckdb Rill Data dashboards to visualize the data Download Data Get Access Token As of writing, I am unsure how to programmatically get the “site key” and access token. Sunpower uses an OAuth2 flow to generate a JSON Web Token (jwt) but I’m not exactly sure how it is implemented.\nInstead, here is how to get the site key and access token manually:\nNavigate to https://login.mysunpower.com/login/login.htm and log in. Open up the developer tools (Develop -\u003e Show Web Inspector in Safari) Open the Network tab in the web inspector and click the trash can to start fresh. Go back a day to load yesterday’s Sunpower data. Inspect the graphql request Authorization header. It says Bearer . Take that token and put it in a file called .env Inspect the request itself to find the siteKey and also put that value in .env. token=\"\" site_key=\"\" The token lasts a pretty long time, so this is probably sufficient.\nEnvironment setup Set up a Python virtual environment and install requirements.\npython3 -m venv venv source venv/bin/activate pip install -r requirements.txt Run the Download Modify the timestamps in get_timeseries_csv.py and run\npython get_timeseries_csv.py The file will be available at data/timeseries/sunpower_timeseries.csv.\nGet Fresh Data Whenever you want, you can adjust the timestamps in get_timeseries_csv.py and csv filename and run it again to get a new csv with fresh data since the last import. Then copy the data into the sunpower table in duckdb with\nCOPY sunpower FROM './data/timeseries/sunpower__to_.csv' (HEADER); Beware of duplicates! Make sure the timeseries don’t overlap.\nRun SQL with duckdb Create a duckdb Database Install the duckdb CLI on your system. For Homebrew users, run\nbrew install duckdb Create a database.\nduckdb ./data/sunpower.db Inside the duckdb shell, load the csv into a table.\nCREATE TABLE sunpower (ts TIMESTAMP, consumption FLOAT, production FLOAT, grid FLOAT); COPY sunpower FROM './data/timeseries/sunpower_timeseries.csv' (HEADER); Create a few useful views.\ncreate view sunpower_hourly as select ts, year(ts) year, month(ts) month, day(ts) day, production, consumption, grid from sunpower; create view sunpower_daily as select date_trunc('day', ts) day, sum(production) as production, sum(consumption) as consumption, sum(grid) as grid from sunpower group by day; create view sunpower_monthly as select date_trunc('month', ts) month, sum(production) as production, sum(consumption) as consumption, sum(grid) as grid from sunpower group by month; create view sunpower_yearly as select date_trunc('year', ts) year, sum(production) as production, sum(consumption) as consumption, sum(grid) as grid from sunpower group by year; Output these aggregates to csv if you’d like.\ncopy (select * from sunpower_daily) to './data/aggregates/daily.csv'; copy (select * from sunpower_monthly) to './data/aggregates/monthly.csv'; copy (select * from sunpower_yearly) to './data/aggregates/yearly.csv'; Play with duckdb I thought this was interesting.\nselect month(day) as month, avg(production) production, avg(consumption) consumption, avg(grid) grid from sunpower_daily group by month order by grid; month production consumption grid 6 48.59366670968011 24.173833327367902 -24.419833369149515 7 51.70338710893186 36.753064496863274 -14.950322639106982 8 44.24016130009606 29.734354813493066 -14.505806475336994 5 44.31112911753477 31.381129051799014 -12.930000026109479 9 36.298166707033914 24.128333315998315 -12.169833363064875 4 38.02533335089684 33.15449992132684 -4.870833339852592 10 27.655806478233107 26.446128989900313 -1.2096774174020655 3 27.762253475414827 39.247746454368176 11.485492896498508 11 15.509166642930358 40.19949999178449 24.690333327340582 2 20.811058854530838 48.012352964983265 27.201294152920738 12 7.298552617112077 45.35565785024511 38.05710524291192 1 9.489139803154494 48.21580643823711 38.72666667590058 June is the most efficient month in terms of average daily net grid usage, sending ~10kWh more back to the grid each day than the next highest month. Production is high and consumption is low. These numbers indicate that most of the usage is seasonal, indicating heat/AC as the main usage.\nWhat are other interesting questions to ask this data?\nAre there any trends when comparing the same month across years? What are the daily averages for each month across years? etc. Exit duckdb Press Ctrl+D at any time to exit the duckdb CLI shell. Enter again with duckdb data/sunpower.db.\nData Visualization with Rill I followed the Rill Data quickstart to create a local dashboard.\nIn the UI, I chose duckdb source with this SQL:\nselect * from read_csv_auto('/sunpower/data/timeseries/sunpower_timeseries.csv', header = true); Rill’s local environment apparently uses duckdb out of the box!\nAfter you install the rill CLI, here is the command to start the UI server:\nrill start sunpower-viz And go to http://localhost:9009.\nRill also generated a dashboard using AI, which saved some time getting to a nice dashboard. For example, here is a year over year comparison of the month of January 2024 vs 2023 for total grid usage:\nA 15% reduction in grid usage year over year!\nNext Steps I’d love to hook up Apache Superset, Grafana, or some other data visualization tool to duckdb. Set up orchestrator job to load new data on a schedule (e.g. with Airflow or Prefect) Other ideas? Real-Time with Materialize. As an extension, I’ve thought about tapping into the server on my physical PVS6 box as outlined in this cool project to get real-time readings. I could then HTTP POST those readings directly into my Materialize database with the Webhook Source and maintain real-time views over the data.\nFull disclosure: Materialize is my employer as of writing.\n",
  "wordCount" : "939",
  "inLanguage": "en",
  "datePublished": "2024-04-15T15:00:04-07:00",
  "dateModified": "2024-04-15T15:00:04-07:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://chuck-alt-delete.github.io/posts/sunpower/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Chuck Alt Delete",
    "logo": {
      "@type": "ImageObject",
      "url": "https://chuck-alt-delete.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://chuck-alt-delete.github.io/" accesskey="h" title="Chuck Alt Delete (Alt + H)">Chuck Alt Delete</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://chuck-alt-delete.github.io/search" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://chuck-alt-delete.github.io/">Home</a>&nbsp;»&nbsp;<a href="https://chuck-alt-delete.github.io/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Sunpower
    </h1>
    <div class="post-meta"><span title='2024-04-15 15:00:04 -0700 PDT'>April 15, 2024</span>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#sunpower-stats" aria-label="Sunpower Stats">Sunpower Stats</a><ul>
                        
                <li>
                    <a href="#download-data" aria-label="Download Data">Download Data</a><ul>
                        
                <li>
                    <a href="#get-access-token" aria-label="Get Access Token">Get Access Token</a></li>
                <li>
                    <a href="#environment-setup" aria-label="Environment setup">Environment setup</a></li>
                <li>
                    <a href="#run-the-download" aria-label="Run the Download">Run the Download</a></li>
                <li>
                    <a href="#get-fresh-data" aria-label="Get Fresh Data">Get Fresh Data</a></li></ul>
                </li>
                <li>
                    <a href="#run-sql-with-duckdb" aria-label="Run SQL with duckdb">Run SQL with duckdb</a><ul>
                        
                <li>
                    <a href="#create-a-duckdb-database" aria-label="Create a duckdb Database">Create a duckdb Database</a></li>
                <li>
                    <a href="#play-with-duckdb" aria-label="Play with duckdb">Play with duckdb</a></li>
                <li>
                    <a href="#exit-duckdb" aria-label="Exit duckdb">Exit duckdb</a></li></ul>
                </li>
                <li>
                    <a href="#data-visualization-with-rill" aria-label="Data Visualization with Rill">Data Visualization with Rill</a></li>
                <li>
                    <a href="#next-steps" aria-label="Next Steps">Next Steps</a></li>
                <li>
                    <a href="#real-time-with-materialize" aria-label="Real-Time with Materialize.">Real-Time with Materialize.</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="sunpower-stats">Sunpower Stats<a hidden class="anchor" aria-hidden="true" href="#sunpower-stats">#</a></h1>
<p>I have a MySunPower system, and I love looking at my data.
However, the app is not as flexible a I want it to be.
It only lets you see a graph of energy usage/production between two points in time.
But I want to answer questions like “how has my usage/production been trending in the month of February over the last several years” or “what is the distribution of usage/production for the hour of 4-5pm” or &ldquo;how does the last 4 months of usage compare to the same period the previous year&rdquo;.</p>
<p>Well, here&rsquo;s the result!</p>
<p><img loading="lazy" src="/images/sunpower/sunpower_avg_daily.png" alt=""  />
</p>
<p>Go to the <a href="https://github.com/chuck-alt-delete/sunpower" target="_blank">GitHub repo</a> to see:</p>
<ul>
<li>Python functions for interacting with the MySunPower GraphQL API to download data locally</li>
<li>documentation to interact with data locally via <code>duckdb</code></li>
<li>Rill Data dashboards to visualize the data</li>
</ul>
<h2 id="download-data">Download Data<a hidden class="anchor" aria-hidden="true" href="#download-data">#</a></h2>
<h3 id="get-access-token">Get Access Token<a hidden class="anchor" aria-hidden="true" href="#get-access-token">#</a></h3>
<p>As of writing, I am unsure how to programmatically get the &ldquo;site key&rdquo; and access token.
Sunpower uses an OAuth2 flow to generate a JSON Web Token (jwt) but I&rsquo;m not exactly sure how it is implemented.</p>
<p>Instead, here is how to get the site key and access token manually:</p>
<ol>
<li>Navigate to <a href="https://login.mysunpower.com/login/login.htm" target="_blank">https://login.mysunpower.com/login/login.htm</a> and log in.</li>
<li>Open up the developer tools (<code>Develop -&gt; Show Web Inspector</code> in Safari)</li>
<li>Open the <code>Network</code> tab in the web inspector and click the trash can to start fresh.</li>
<li>Go back a day to load yesterday&rsquo;s Sunpower data.</li>
<li>Inspect the <code>graphql</code> request <code>Authorization</code> header. It says <code>Bearer &lt;token&gt;</code>.</li>
<li>Take that token and put it in a file called <code>.env</code></li>
<li>Inspect the request itself to find the <code>siteKey</code> and also put that value in <code>.env</code>.</li>
</ol>
<pre tabindex="0"><code>token=&#34;&lt;your long token here&gt;&#34;
site_key=&#34;&lt;your site key here&gt;&#34;
</code></pre><p>The token lasts a pretty long time, so this is probably sufficient.</p>
<h3 id="environment-setup">Environment setup<a hidden class="anchor" aria-hidden="true" href="#environment-setup">#</a></h3>
<p>Set up a Python virtual environment and install requirements.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python3 -m venv venv
</span></span><span style="display:flex;"><span>source venv/bin/activate
</span></span><span style="display:flex;"><span>pip install -r requirements.txt
</span></span></code></pre></div><h3 id="run-the-download">Run the Download<a hidden class="anchor" aria-hidden="true" href="#run-the-download">#</a></h3>
<p>Modify the timestamps in <code>get_timeseries_csv.py</code> and run</p>
<pre tabindex="0"><code>python get_timeseries_csv.py
</code></pre><p>The file will be available at <code>data/timeseries/sunpower_timeseries.csv</code>.</p>
<h3 id="get-fresh-data">Get Fresh Data<a hidden class="anchor" aria-hidden="true" href="#get-fresh-data">#</a></h3>
<p>Whenever you want, you can adjust the timestamps in <code>get_timeseries_csv.py</code> and <code>csv</code> filename and run it again to get a new csv with fresh data since the last import.
Then copy the data into the <code>sunpower</code> table in <code>duckdb</code> with</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">COPY</span> sunpower <span style="color:#66d9ef">FROM</span> <span style="color:#e6db74">&#39;./data/timeseries/sunpower_&lt;date&gt;_to_&lt;date&gt;.csv&#39;</span> (HEADER);
</span></span></code></pre></div><p>Beware of duplicates! Make sure the timeseries don&rsquo;t overlap.</p>
<h2 id="run-sql-with-duckdb">Run SQL with <code>duckdb</code><a hidden class="anchor" aria-hidden="true" href="#run-sql-with-duckdb">#</a></h2>
<h3 id="create-a-duckdb-database">Create a duckdb Database<a hidden class="anchor" aria-hidden="true" href="#create-a-duckdb-database">#</a></h3>
<p>Install the <code>duckdb</code> CLI on your system. For Homebrew users, run</p>
<pre tabindex="0"><code>brew install duckdb
</code></pre><p>Create a database.</p>
<pre tabindex="0"><code>duckdb ./data/sunpower.db
</code></pre><p>Inside the <code>duckdb</code> shell, load the csv into a table.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> sunpower (ts <span style="color:#66d9ef">TIMESTAMP</span>, consumption FLOAT, production FLOAT, grid FLOAT);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">COPY</span> sunpower <span style="color:#66d9ef">FROM</span> <span style="color:#e6db74">&#39;./data/timeseries/sunpower_timeseries.csv&#39;</span> (HEADER);
</span></span></code></pre></div><p>Create a few useful views.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">view</span> sunpower_hourly <span style="color:#66d9ef">as</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">select</span> 
</span></span><span style="display:flex;"><span>    ts,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">year</span>(ts) <span style="color:#66d9ef">year</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">month</span>(ts) <span style="color:#66d9ef">month</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">day</span>(ts) <span style="color:#66d9ef">day</span>,
</span></span><span style="display:flex;"><span>    production,
</span></span><span style="display:flex;"><span>    consumption,
</span></span><span style="display:flex;"><span>    grid
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">from</span> sunpower;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">view</span> sunpower_daily <span style="color:#66d9ef">as</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">select</span> 
</span></span><span style="display:flex;"><span>    date_trunc(<span style="color:#e6db74">&#39;day&#39;</span>, ts) <span style="color:#66d9ef">day</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">sum</span>(production) <span style="color:#66d9ef">as</span> production,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">sum</span>(consumption) <span style="color:#66d9ef">as</span> consumption,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">sum</span>(grid) <span style="color:#66d9ef">as</span> grid
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">from</span> sunpower 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">group</span> <span style="color:#66d9ef">by</span> <span style="color:#66d9ef">day</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">view</span> sunpower_monthly <span style="color:#66d9ef">as</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">select</span> 
</span></span><span style="display:flex;"><span>    date_trunc(<span style="color:#e6db74">&#39;month&#39;</span>, ts) <span style="color:#66d9ef">month</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">sum</span>(production) <span style="color:#66d9ef">as</span> production,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">sum</span>(consumption) <span style="color:#66d9ef">as</span> consumption,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">sum</span>(grid) <span style="color:#66d9ef">as</span> grid
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">from</span> sunpower 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">group</span> <span style="color:#66d9ef">by</span> <span style="color:#66d9ef">month</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">create</span> <span style="color:#66d9ef">view</span> sunpower_yearly <span style="color:#66d9ef">as</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">select</span> 
</span></span><span style="display:flex;"><span>    date_trunc(<span style="color:#e6db74">&#39;year&#39;</span>, ts) <span style="color:#66d9ef">year</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">sum</span>(production) <span style="color:#66d9ef">as</span> production,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">sum</span>(consumption) <span style="color:#66d9ef">as</span> consumption,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">sum</span>(grid) <span style="color:#66d9ef">as</span> grid
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">from</span> sunpower 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">group</span> <span style="color:#66d9ef">by</span> <span style="color:#66d9ef">year</span>;
</span></span></code></pre></div><p>Output these aggregates to csv if you&rsquo;d like.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">copy</span> (<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> sunpower_daily) <span style="color:#66d9ef">to</span> <span style="color:#e6db74">&#39;./data/aggregates/daily.csv&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">copy</span> (<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> sunpower_monthly) <span style="color:#66d9ef">to</span> <span style="color:#e6db74">&#39;./data/aggregates/monthly.csv&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">copy</span> (<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> sunpower_yearly) <span style="color:#66d9ef">to</span> <span style="color:#e6db74">&#39;./data/aggregates/yearly.csv&#39;</span>;
</span></span></code></pre></div><h3 id="play-with-duckdb">Play with <code>duckdb</code><a hidden class="anchor" aria-hidden="true" href="#play-with-duckdb">#</a></h3>
<p>I thought this was interesting.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">select</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">month</span>(<span style="color:#66d9ef">day</span>) <span style="color:#66d9ef">as</span> <span style="color:#66d9ef">month</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">avg</span>(production) production,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">avg</span>(consumption) consumption,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">avg</span>(grid) grid
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">from</span> sunpower_daily 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">group</span> <span style="color:#66d9ef">by</span> <span style="color:#66d9ef">month</span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> grid;
</span></span></code></pre></div><table>
<thead>
<tr>
<th>month</th>
<th>production</th>
<th>consumption</th>
<th>grid</th>
</tr>
</thead>
<tbody>
<tr>
<td>6</td>
<td>48.59366670968011</td>
<td>24.173833327367902</td>
<td>-24.419833369149515</td>
</tr>
<tr>
<td>7</td>
<td>51.70338710893186</td>
<td>36.753064496863274</td>
<td>-14.950322639106982</td>
</tr>
<tr>
<td>8</td>
<td>44.24016130009606</td>
<td>29.734354813493066</td>
<td>-14.505806475336994</td>
</tr>
<tr>
<td>5</td>
<td>44.31112911753477</td>
<td>31.381129051799014</td>
<td>-12.930000026109479</td>
</tr>
<tr>
<td>9</td>
<td>36.298166707033914</td>
<td>24.128333315998315</td>
<td>-12.169833363064875</td>
</tr>
<tr>
<td>4</td>
<td>38.02533335089684</td>
<td>33.15449992132684</td>
<td>-4.870833339852592</td>
</tr>
<tr>
<td>10</td>
<td>27.655806478233107</td>
<td>26.446128989900313</td>
<td>-1.2096774174020655</td>
</tr>
<tr>
<td>3</td>
<td>27.762253475414827</td>
<td>39.247746454368176</td>
<td>11.485492896498508</td>
</tr>
<tr>
<td>11</td>
<td>15.509166642930358</td>
<td>40.19949999178449</td>
<td>24.690333327340582</td>
</tr>
<tr>
<td>2</td>
<td>20.811058854530838</td>
<td>48.012352964983265</td>
<td>27.201294152920738</td>
</tr>
<tr>
<td>12</td>
<td>7.298552617112077</td>
<td>45.35565785024511</td>
<td>38.05710524291192</td>
</tr>
<tr>
<td>1</td>
<td>9.489139803154494</td>
<td>48.21580643823711</td>
<td>38.72666667590058</td>
</tr>
</tbody>
</table>
<p>June is the most efficient month in terms of average daily net grid usage, sending ~10kWh more back to the grid each day than the next highest month. Production is high and consumption is low. These numbers indicate that most of the usage is seasonal, indicating heat/AC as the main usage.</p>
<p>What are other interesting questions to ask this data?</p>
<ul>
<li>Are there any trends when comparing the same month across years?</li>
<li>What are the daily averages for each month across years?</li>
<li>etc.</li>
</ul>
<h3 id="exit-duckdb">Exit <code>duckdb</code><a hidden class="anchor" aria-hidden="true" href="#exit-duckdb">#</a></h3>
<p>Press <code>Ctrl+D</code> at any time to exit the <code>duckdb</code> CLI shell. Enter again with <code>duckdb data/sunpower.db</code>.</p>
<h2 id="data-visualization-with-rill">Data Visualization with Rill<a hidden class="anchor" aria-hidden="true" href="#data-visualization-with-rill">#</a></h2>
<p>I followed the Rill Data <a href="https://docs.rilldata.com/get-started" target="_blank">quickstart</a> to create a local dashboard.</p>
<p>In the UI, I chose <code>duckdb</code> source with this SQL:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> read_csv_auto(<span style="color:#e6db74">&#39;&lt;path to&gt;/sunpower/data/timeseries/sunpower_timeseries.csv&#39;</span>, header <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>);
</span></span></code></pre></div><p>Rill&rsquo;s local environment apparently uses <code>duckdb</code> out of the box!</p>
<p>After you install the <code>rill</code> CLI, here is the command to start the UI server:</p>
<pre tabindex="0"><code>rill start sunpower-viz
</code></pre><p>And go to http://localhost:9009.</p>
<p>Rill also generated a dashboard using AI, which saved some time getting to a nice dashboard. For example, here is a year over year comparison of the month of January 2024 vs 2023 for total grid usage:</p>
<p><img loading="lazy" src="/images/sunpower/jan-2024-2023.png" alt="January 2024 (blue) vs 2023 (grey)"  />
</p>
<p>A 15% reduction in grid usage year over year!</p>
<h2 id="next-steps">Next Steps<a hidden class="anchor" aria-hidden="true" href="#next-steps">#</a></h2>
<ul>
<li>I&rsquo;d love to hook up Apache Superset, Grafana, or some other data visualization tool to duckdb.</li>
<li>Set up orchestrator job to load new data on a schedule (e.g. with Airflow or Prefect)</li>
<li>Other ideas?</li>
</ul>
<h2 id="real-time-with-materialize">Real-Time with Materialize.<a hidden class="anchor" aria-hidden="true" href="#real-time-with-materialize">#</a></h2>
<p>As an extension, I&rsquo;ve thought about tapping into the server on my physical PVS6 box as outlined in <a href="https://github.com/ginoledesma/sunpower-pvs-exporter" target="_blank">this cool project</a> to get real-time readings. I could then <code>HTTP POST</code> those readings directly into my <a href="https://materialize.com" target="_blank">Materialize</a> database with the <a href="https://materialize.com/docs/sql/create-source/webhook/" target="_blank">Webhook Source</a> and maintain real-time views over the data.</p>
<p>Full disclosure: Materialize is my employer as of writing.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>

<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Sunpower on x"
            href="https://x.com/intent/tweet/?text=Sunpower&amp;url=https%3a%2f%2fchuck-alt-delete.github.io%2fposts%2fsunpower%2f&amp;hashtags=">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Sunpower on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fchuck-alt-delete.github.io%2fposts%2fsunpower%2f&amp;title=Sunpower&amp;summary=Sunpower&amp;source=https%3a%2f%2fchuck-alt-delete.github.io%2fposts%2fsunpower%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Sunpower on reddit"
            href="https://reddit.com/submit?url=https%3a%2f%2fchuck-alt-delete.github.io%2fposts%2fsunpower%2f&title=Sunpower">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Sunpower on facebook"
            href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fchuck-alt-delete.github.io%2fposts%2fsunpower%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Sunpower on whatsapp"
            href="https://api.whatsapp.com/send?text=Sunpower%20-%20https%3a%2f%2fchuck-alt-delete.github.io%2fposts%2fsunpower%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Sunpower on telegram"
            href="https://telegram.me/share/url?text=Sunpower&amp;url=https%3a%2f%2fchuck-alt-delete.github.io%2fposts%2fsunpower%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Sunpower on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=Sunpower&u=https%3a%2f%2fchuck-alt-delete.github.io%2fposts%2fsunpower%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="https://chuck-alt-delete.github.io/">Chuck Alt Delete</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
